api.fasfsaef.store {
  encode zstd gzip

  # ----- CORS -----
  header {
    Access-Control-Allow-Origin https://blockpair.netlify.app
    Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
    Access-Control-Allow-Headers "Content-Type, Authorization"
    Access-Control-Allow-Credentials true
    Vary Origin
  }

  # Preflight
  @preflight {
    method OPTIONS
    header Origin *
    header Access-Control-Request-Method *
  }
  respond @preflight 204

  # ----- Routing -----
  # WebSocket upgrade requests -> :5000
  @ws {
    header Connection *Upgrade*
    header Upgrade websocket
  }
  handle @ws {
    reverse_proxy server:5000
  }

  # Everything else (REST/api) -> :3000
  handle {
    reverse_proxy server:3000
  }
}
